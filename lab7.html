<!--
	THIS EXAMPLE WAS DOWNLOADED FROM https://echarts.apache.org/examples/en/editor.html?c=map-usa&code=LYTwwgFghgTgLgOgM4QPYHcAyqoBMCWAdgOYAUAlANwBQAJAsQKZykBKA8uwCoD6ACgEEuACQAEAalEByAPS4ocKDKhIkzGU1Qz0qGABtcCAFZJUhKQBpRAMwCuhAMZx8Z0aVtIoAKVOFyogG9qUVFQSFhECHxcRmw8IjIqYNFGB2h4JAQYRmJ8JDhGGABZKAAHUikAVQBlAUtRD29fKyCQkIE9FQBrKAAuQOS20T1Gazh-gFoARgBmKYtBtrhUUv6AJgBWBaGQ9Gi4CH6pjcWAX2224Sh0KHx8ftadkbHJqamABguh5dXRNYAOL5tPa4A79E5Dc6LKR8WyFZaiVj4ByoKQPRYhZ7jUQTADsADYgSEfutCRjRCCwX8zslTkkQitnK4ALwDb74OAjdE7UQFAAe2KqtVEfBWtk6TMIogAovl8MAFIwkG41u8pmtyJZyUhbAAjfmCgAiCigNhgqGAFPQ6AQDkYhB1mWIqAAblqeTrdXoiF1-lIIHA4KsZNprbb7Y6GK6ZKUVkq4HITYnFGo4JkA8A9O6nqNBTB8MQA1IzkDlqg9M5fo9vvniEwYH6OYxgNmhigMIbGJ0QP1PuS4DAoA6OS5CIbbIPJb2EGsS4sXXlbFA9CUq-SsX7a0WiaEiOD3geDzuFXz-jN_ofDzuiKwh0xuTzRCi9Lp-gBtclDKQAYjmM3xACcGyto-P4ACwbLiGy6mBIE8j-uJgXguBTHBOw_lAuq4ABjAAWhX7fow7zWDM1j_PhbQ_tY1HWLq1gUSEVGMERAHvAx0jftY8iMPiqE7gR1hgfiuBgTM7E_rguIzO8ay4uJ35QBsB5rPixaPqIAC65JQjyBrvlIwgFhA9RSNg6BSBpO4OMuDjiphXK8jAcJzt8qDlrqqCnmyOztug_QDnCO4hro-D2oKLrwsiy5oRu0hYmhJLSD8aHWIwCgTowD48vIigAGqhX5gSiNkeDsIQeg9jYy5qKIOmPtk-S6JlgR1R6UARQISAAJIKveLXaS5bRqPmSrvuS1Y7IQUDAM1QoCCKKyys4CoFEgFFwCApSzQqpQUea03-U5jD8aEZR-jUdQnc2pTQEgeRZY-nS6l2D3qb5h3OepISnJ-tUnTlfSiB-X1FVNM1-h0mHTVA9QusucL9GB_xrKqawzH9v0hAEohg7NkNID0sPw81UlTGBYEARjIPY7jEP5gAXmYMNWHDegI6I-IbBsMybBsVNfTT014zAPQOioRNs81awARTsxTPz6mC-D0hgMu-DWLohD4Mzois-z57vGBZPSQrj5K7NYDlroeCoizxPglM_xQcjps8ubfqW4QhCpM4tlwBL-sbKxMxgbirs7O70idp0NzZAHzUAVMuLvABazh0MkdSIaeQDsicCiKg1iiJbbPALq2vx_0-I8zX6dtJnABiL75vIleiFMAFzFB-L_HXWM40LfoAOKMLouQ63rCeJwBMt861ZsD8rBnXLc-Bt7Mqd_n3oOD9IXXyGg69B5BALb5nXV6N6hCoHk68AlBvNn4vs1dYQBBDhP9sc9zUkh0_tN7wwJ_SWZ53iIUdvif-u8pAAGkhyeDWnbEBfx_j_CDu8OeJ1-4ANgWFWwDguggDbqJC8RtMGYx3kvbAtg8jaymsQ_Eap_idygUvEoRBGDrx5tPNO883bPz9CUGAIBOhvzbhsVBEFq6sNmiUVQUA0geGYGmNu-J8RCTJmBGRgjkRRGIEONuAFUEzH_O8bR0gihEG9qYRQ4iZi4kTjMSmfCI4CIsXkO6qh8ClFKGvJB7Npb_ApipcxUhLGqFQBOPxusv6MLWB3VBoSihmEUPQ_xzUPgYLJvLFxGc3FSAAHKMF1IOAmwD2aOy5hsTYoSilw1buk9YztO45KwZQ2aRT0CiCuMAUoKB8Bx0ae3HmYDHa1MYF0rwhQ1BEKGag9R6DxldKKIwPkyJbYxOQaqNB3Ne65PrvkzpogACaugujryAsnFSrSKGZwKboA4xdYDliIOUhOD8wHo32dg6B9z4AQFEMaLoqBbFDMAgBfEp9vntL9OwKIGzJ5HGOOTFG5Dqb5PYF0ToaAFRt3PGTZGZjoWZ3YNkZ05ghnnhnjMbmoS-D2gdCIuGWs3lHFktXbmkDiX5NYGgGIogupIFEbgdeGCZKp1CdUSJjzVbmivqy0Qoc0a4jRpK6VAKgUgoVf8ExNKtHcpwVwBlSo1CcLBVItYolQlGr5OLIZKkMGp3eF8tpmdKiKGMvanZ99Qm5UKMAFJqiHVvF9QM3ILK27_Eqf8fEYcDXQIAOoqCiCQZYFLNnsx7gBZO6pQkJvjKIfKMBw0VyGZUjYRsXW3PyQmvIKJhzpsRaIE-1cjF5pABaBI4iCRG14a6_JsJ4SoEROsvFajk5BNqr9LSPIfpDBnbVGgIQwjpEQKmdgpRJSkEZKOJIdJKBAA
	⚠ Please be aware that this chart is not an official demo of Apache ECharts but is made by user-generated code.
-->
<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
  <meta charset="utf-8">
</head>
<body style="height: 100%; margin: 0">
  <div id="container" style="height: 60%"></div>
  <div id="c2" style="height: 40%"></div>

  <select id="seletor" style="top: 0; position: absolute; right: 0">
    <option value="EXP">Exportações</option>
    <option value="IMP">Importações</option>
    <option value="BAL">Balança Comercial (EXP - IMP)</option>
  </select>

  <script type="text/javascript" src="https://echarts.apache.org/en/js/vendors/jquery@3.7.1/dist/jquery.min.js"></script>
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  
  <!-- Uncomment this line if you want to dataTool extension
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/extension/dataTool.min.js"></script>
  -->
  <!-- Uncomment this line if you want to use gl extension
  <script type="text/javascript" src="https://echarts.apache.org/en/js/vendors/echarts-gl/dist/echarts-gl.min.js"></script>
  -->
  <!-- Uncomment this line if you want to echarts-stat extension
  <script type="text/javascript" src="https://echarts.apache.org/en/js/vendors/echarts-stat/dist/ecStat.min.js"></script>
  -->
  <!-- Uncomment this line if you want to echarts-graph-modularity extension
  <script type="text/javascript" src="https://echarts.apache.org/en/js/vendors/echarts-graph-modularity/dist/echarts-graph-modularity.min.js"></script>
  -->
  
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@4.9.0/map/js/world.js"></script>
  
  <!-- Uncomment these two lines if you want to use bmap extension
  <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=YOUR_API_KEY"></script>
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/extension/bmap.min.js"></script>
  -->

  <script type="text/javascript">
    const tmp = async () => {
      const getData = async () => {
        return await (await fetch('./BR-exportacoes_importacoes_2025.json')).json();
      }

      const dados = await getData()
      var dom = document.getElementById('container');
      let c2 = document.getElementById('c2')
      var myChart = echarts.init(dom, null, {
        renderer: 'canvas',
        useDirtyRect: false
      });
      let chart2 = echarts.init(c2, null, {
        renderer: 'canvas',
        useDirtyRect: false
      });
      var app = {};
      var ROOT_PATH = 'https://echarts.apache.org/examples';
      var option;
      let op2;

      myChart.showLoading();

      myChart.hideLoading();

      const valMin = (v) => {
        return v.reduce((x, y) => (y < x ? y : x))
      }

      const valMax = (v) => {
        return v.reduce((x, y) => (y > x ? y : x))
      }

      const dolar = (v) => {
        if (isNaN(v)) {
          return 'None'
        }

        if (Math.abs(v) > 1) {
          return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'USD' }).format(v) + " bi";
        } else {
          return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'USD' }).format(v * 1_000) + " mi";
        }
      }

      const somaAno = (d) => {
        return d.reduce((x, y) => x + y.us_value, 0);
      }

      op2 = {
        title: {
          text: 'Totais por ano'
        },
        tooltip: {
          trigger: 'axis',
          axisPointer: {
            type: 'shadow',
            shadowStyle: {
              color: 'rgba(150, 150, 200, 0.1)'
            }
          },
          valueFormatter: (value) => dolar(value)
        },
        legend: {
          data: ['Exportações', 'Importações', 'Balança Comercial']
        },
        grid: {
          left: '3%',
          right: '4%',
          bottom: '30%',
          containLabel: true
        },
        toolbox: {
          trigger: 'axis',
        },
        xAxis: {
          name: 'Série histórica',
          nameLocation: 'middle',
          nameGap: 30,
          type: 'category',
          boundaryGap: false,
          data: Object.keys(dados.BAL)
        },
        yAxis: {
          type: 'value',
          name: 'Bilhões em US$'
        },
        dataZoom: [
          {
            type: 'inside'
          },
          {
            type: 'slider',
            show: true,
            height: 25,
            left: '10%',
            right: '10%'
          }
        ],
        series: [
          {
            name: 'Exportações',
            type: 'line',
            smooth: true,
            emphasis: { focus: 'series' },
            data: Object.values(dados.EXP).map(v => somaAno(v) / 1000000000),
          },
          {
            name: 'Importações',
            type: 'line',
            smooth: true,
            emphasis: { focus: 'series' },
            data: Object.values(dados.IMP).map(v => somaAno(v) / 1000000000)
          },
          {
            name: 'Balança Comercial',
            type: 'line',
            smooth: true,
            emphasis: { focus: 'series' },
            data: Object.values(dados.BAL).map(v => somaAno(v) / 1000000000)
          },
        ]
      }

      chart2.setOption(op2)

      const changeType = (type, ano) => {
        let newOp;

        const ndata = dados[type][ano].map(obj => ({name: obj.name, value: obj.us_value / 1000000000}))
        
        if (type == 'BAL') {
          newOp = {
            title: {
              text: `Volume na balança comercial do Brasil (${ano})`,
              subtext: 'Dados do Monitor do Comércio Exterior Brasileiro',
              sublink: 'https://balanca.economia.gov.br/balanca/IPQ/index.html',
              left: 'center'
            },
            tooltip: {
              trigger: 'item',
              showDelay: 0,
              transitionDuration: 0.2
            },
            visualMap: {
              left: 'right',
              min: - (valMax(ndata.map(v => v.value))),
              max: valMax(ndata.map(v => v.value)),
              inRange: {
                color: [
                  '#a61f1f',
                  '#f7f7f7',
                  '#078527'
                ]
              },
              text: ['High', 'Low'],
              type: 'continuous',
              calculable: true,
              itemHeight: 300
            },
            toolbox: {
              show: true,
              left: 'left',
              top: 'top',
              feature: {
                dataView: { readOnly: false },
                restore: {},
                saveAsImage: {}
              }
            },
            series: [
              {
                name: '',
                type: 'map',
                roam: true,
                map: 'world',
                emphasis: {
                  label: {
                    show: true
                  }
                },
                data: ndata
              }
            ]
          }
        } else if (type == 'IMP') {
            newOp = {
              title: {
                text: `Volume de Importação do Brasil (${ano})`,
                subtext: 'Dados do Monitor do Comércio Exterior Brasileiro',
                sublink: 'https://balanca.economia.gov.br/balanca/IPQ/index.html',
                left: 'center'
              },
              tooltip: {
                trigger: 'item',
                showDelay: 0,
                transitionDuration: 0.2
              },
              visualMap: {
                left: 'right',
                min: valMin(ndata.map(v => v.value)),
                max: valMax(ndata.map(v => v.value)),
                inRange: {
                  color: [
                    '#dbbfbf',
                    '#a61f1f'
                  ]
                },
                text: ['High', 'Low'],
                type: 'continuous',
                calculable: true,
                itemHeight: 300
              },
              toolbox: {
                show: true,
                left: 'left',
                top: 'top',
                feature: {
                  dataView: { readOnly: false },
                  restore: {},
                  saveAsImage: {}
                }
              },
              series: [
                {
                  name: '',
                  type: 'map',
                  roam: true,
                  map: 'world',
                  emphasis: {
                    label: {
                      show: true
                    }
                  },
                  data: ndata
                }
              ]
            }
          } else {
            newOp = {
              title: {
                text: `Volume de Exportações do Brasil (${ano})`,
                subtext: 'Dados do Monitor do Comércio Exterior Brasileiro',
                sublink: 'https://balanca.economia.gov.br/balanca/IPQ/index.html',
                left: 'center'
              },
              tooltip: {
                trigger: 'item',
                showDelay: 0,
                transitionDuration: 0.2,
                formatter: (params) => {
                  return `${params.name}<br/><b>${dolar(params.data.value)}</b>`;
                }
              },
              visualMap: {
                left: 'right',
                top: 'center',
                min: valMin(ndata.map(v => v.value)),
                max: valMax(ndata.map(v => v.value)),
                inRange: {
                  color: [
                    '#a3c4ab',
                    '#078527'
                  ]
                },
                text: ['High', 'Low'],
                type: 'continuous',
                calculable: true,
                itemHeight: 300
              },
              toolbox: {
                show: true,
                left: 'left',
                top: 'top',
                feature: {
                  dataView: { readOnly: false },
                  restore: {},
                  saveAsImage: {}
                }
              },
              series: [
                {
                  name: '',
                  type: 'map',
                  roam: true,
                  map: 'world',
                  emphasis: {
                    label: {
                      show: false
                    }
                  },
                  data: ndata
                }
              ]
            };
          }

          myChart.setOption(newOp);
      }

      changeType('EXP', 2025);

      window.addEventListener('resize', myChart.resize);
      window.addEventListener('resize', chart2.resize);
      document.getElementById('seletor').addEventListener('change', e => {
        changeType(e.target.value, 2025);
      });

      chart2.on('click', (params) => {
        const ano = params.name;

        const tipoSerie = params.seriesName;

        const tiposMap = {
          'Exportações': 'EXP',
          'Importações': 'IMP',
          'Balança Comercial': 'BAL'
        };

        const tipo = tiposMap[tipoSerie];

        changeType(tipo, ano);
        document.getElementById('seletor').value = tipo
      });
    }

    tmp()
  </script>
</body>
</html>